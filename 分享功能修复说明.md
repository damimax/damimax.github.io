# 分享功能修复说明

## 问题描述
在微信内浏览器中，点击分享按钮会弹出分享调用，但是选择不了要分享的成员，之后自动关闭了选人的弹框，页面上面显示分享成功，这是一个缺陷。

## 修复内容

### 1. 微信内浏览器检测和特殊处理
- 添加了 `isInWeChat()` 方法专门检测微信内浏览器
- 在微信内浏览器中，直接显示专用提示，不调用原生分享API
- 提供三种分享方案：
  - 方法一：点击右上角菜单 → 在浏览器中打开 → 点击右下角分享按钮
  - 方法二：复制链接到系统浏览器打开后分享
  - 方法三：直接复制链接分享给朋友

### 2. 动态倒计时标题
- 页面标题和分享标题都包含实时倒计时：`郑州 · 龙湖熙上 | 二期合同交付倒计时 X 天`
- 动态更新Open Graph和Twitter meta标签，确保分享时显示正确的标题
- 保留描述文本，但不重复倒计时信息
- 每分钟自动更新分享数据，确保倒计时准确性
- 添加了 `updatePageMeta()` 方法更新页面meta标签
- 添加了 `updateTooltipDisplay()` 方法更新提示框显示

### 3. 分享状态管理
- 添加了 `setShareState()` 方法跟踪分享状态
- 改进了错误处理，避免在用户取消分享时显示错误
- 修复了分享弹框自动关闭的问题

### 4. 样式修复
- 修复了模态框标题颜色显示问题（从 `#eee` 改为 `#333`）
- 优化了微信专用提示的样式和内容

## 文件修改

### js/share.js
- 添加微信检测方法 `isInWeChat()`
- 添加微信专用提示 `showWeChatBrowserPrompt()`
- 改进 `nativeShare()` 方法，优先检测微信环境
- 添加分享状态管理 `setShareState()`
- 添加定时器 `startShareDataTimer()` 自动更新分享数据
- 添加页面meta标签更新方法 `updatePageMeta()`
- 添加提示框更新方法 `updateTooltipDisplay()`
- 修改 `updateShareData()` 方法，动态生成包含倒计时的标题

### css/share.css
- 修复模态框标题颜色显示问题

### 新增测试页面
- `test-share.html` - 微信内浏览器分享功能测试
- `test-dynamic-title.html` - 动态倒计时标题测试

## 使用方法

### 在微信内浏览器中
1. 点击右下角分享按钮
2. 系统会显示微信专用提示
3. 按照提示操作：点击右上角菜单 → 在浏览器中打开
4. 在系统浏览器中点击分享按钮进行分享

### 在外部浏览器中
1. 点击右下角分享按钮
2. 系统会调用原生分享API
3. 选择要分享的应用或联系人

### 分享数据格式
- **标题**（有倒计时时）：`郑州 · 龙湖熙上 | 二期合同交付倒计时 X 天`
- **标题**（无倒计时时）：`郑州 · 龙湖熙上 | 二期合同交付倒计时`
- **描述**：`时间正一分一秒地紧迫流逝，交付若不达标，我们绝不妥协，必捍卫合法权益。`

## 测试方法

1. 在微信内浏览器中打开 `test-share.html` 测试微信专用功能
2. 在外部浏览器中打开 `test-dynamic-title.html` 测试动态标题功能
3. 使用测试页面的按钮验证各项功能

## 技术细节

- 使用 `navigator.userAgent` 检测微信内浏览器
- 使用 `navigator.share()` API 进行原生分享
- 使用 `setInterval()` 定时更新分享数据
- 使用 `localStorage` 记录用户偏好设置 